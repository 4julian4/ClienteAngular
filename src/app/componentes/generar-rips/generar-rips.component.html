<!-- generar-rips.component.html -->
<div class="gestion-presentar-generar-rips">
  <div class="formularioGenerarRips">
    <form [formGroup]="ripsForm">
      <mat-form-field appearance="fill" class="campoFila1">
        <mat-label>Fecha Inicio</mat-label>
        <input
          matInput
          [matDatepicker]="pickerInicio"
          formControlName="fechaInicio"
          placeholder="Fecha Inicio"
        />
        <mat-datepicker-toggle
          matSuffix
          [for]="pickerInicio"
        ></mat-datepicker-toggle>
        <mat-datepicker #pickerInicio></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="fill" class="campoFila1">
        <mat-label>Fecha Fin</mat-label>
        <input
          matInput
          [matDatepicker]="pickerFin"
          formControlName="fechaFin"
          placeholder="Fecha Fin"
        />
        <mat-datepicker-toggle
          matSuffix
          [for]="pickerFin"
        ></mat-datepicker-toggle>
        <mat-datepicker #pickerFin></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="fill" class="campoFila1">
        <mat-label>C√≥digo EPS</mat-label>
        <input matInput formControlName="codigoEps" placeholder="C√≥digo EPS" />
      </mat-form-field>

      <mat-form-field appearance="fill" class="campoFila1">
        <mat-label>Factura</mat-label>
        <input matInput formControlName="factura" placeholder="Factura" />
      </mat-form-field>

      <mat-form-field appearance="fill" class="campoFila2">
        <mat-label>Raz√≥n Social</mat-label>
        <mat-select formControlName="idReporte">
          <mat-option
            *ngFor="let reporte of listaInformacionReporte"
            [value]="reporte.id"
          >
            {{ reporte.nombre }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill" class="campoFila2">
        <mat-label>Doctor</mat-label>
        <mat-select formControlName="idDoctor">
          <mat-option value="">Seleccione uno</mat-option>
          <mat-option value="-1">[ TODOS ]</mat-option>
          <mat-option *ngFor="let doctor of listaDoctores" [value]="doctor.id">
            {{ doctor.nombre }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <div class="divContenedorDeBotones">
        <button
          mat-raised-button
          class="BotonDescargar"
          (click)="generarRips(0)"
          [disabled]="isloading"
        >
          ‚¨áÔ∏è Descargar RIPS
        </button>
        <button
          mat-raised-button
          class="BotonGenerar"
          (click)="presentarRips(0)"
          [disabled]="isloading"
        >
          üì§ Presentar RIPS
        </button>
      </div>

      <!-- ‚úÖ Overlay loading + progreso -->
      <div class="overlay-loading" *ngIf="isloading">
        <div class="overlay-card">
          <mat-spinner diameter="42"></mat-spinner>

          <div class="overlay-title">Procesando RIPS‚Ä¶</div>
          <div class="overlay-subtitle">{{ progressLabel }}</div>

          <mat-progress-bar
            class="overlay-bar"
            mode="determinate"
            [value]="progressPercent"
          >
          </mat-progress-bar>

          <div class="overlay-stats" *ngIf="progreso">
            <div><b>Total:</b> {{ progreso.total || 0 }}</div>
            <div><b>Procesadas:</b> {{ progreso.procesadas || 0 }}</div>
            <div><b>OK:</b> {{ progreso.exitosas || 0 }}</div>
            <div><b>Fallidas:</b> {{ progreso.fallidas || 0 }}</div>
            <div class="overlay-last" *ngIf="progreso.ultimoDocumento">
              <b>√öltima:</b> {{ progreso.ultimoDocumento }}
            </div>
          </div>

          <div class="overlay-hint">
            No cierres esta ventana. Al finalizar se descargar√° el JSON
            autom√°ticamente.
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
